---
title: "Crime"
author: "Derek Schiltz"
date: "2023-04-04"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)

library(tidyverse)
library(lubridate)
source("../scripts/viridis.R")
```

## R Markdown

This is an R Markdown document. Markdown is a simple formatting syntax for authoring HTML, PDF, and MS Word documents. For more details on using R Markdown see <http://rmarkdown.rstudio.com>.

When you click the **Knit** button a document will be generated that includes both content as well as the output of any embedded R code chunks within the document. You can embed an R code chunk like this:

```{r cars}
crime = read_csv("../data/crime.csv")
```

> Introduction:

- Our group’s project focuses on crime data reflecting incidents of crime in Los Angeles dating back to 2020. The original data set is structured such that one observation (row of data) reflects one documented crime incident. Within each observation are several variables that specifically describe the crime description, location, timing, and details about the alleged perpetrator and alleged victim, if any. Given the magnitude of our data (almost 700,000 observations) and the varying relevance of each variable, we conducted rigorous cleaning to filter it down to 8 variables of interest.

- After cleaning the data, we began to determine how to further filter the data in order to have a smaller number of observations to deal with. With a smaller number of observations, it became simpler to conduct statistical analysis resulting in relevant conclusions that can answer specific questions. Specifically, we decided to focus only on arson crimes. One of our data-cleaning techniques involved categorizing the time each crime occurred into discrete sections of the day (early morning, morning, afternoon, early evening, and late evening). Another one of our data-cleaning techniques involved adding a “Weapon Presence” variable which contains either “No Weapon” or “Weapon Present” for each crime observation. With these two variables, we were able to devise a specific question.

- Our question of interest is: For all “arson” crimes, is it significantly more likely for a weapon to be involved in the late evening compared to the early morning? Explained further, we intend to compare the proportion of late evening arson crimes that have a weapon involved with the proportion of early morning arson crimes that have a weapon involved. The motivation for examining the “weapon presence” variable is that this is a categorical variable, thus allowing us to perform hypothesis testing involving proportions. 

- The main point of the report is to discover the effect, if any, of the time of day on a perpetrator’s decision to commit arson either with a weapon or without one. We believe that the differences in weapon presence proportions between these two times of day will not provide exceedingly convincing evidence that the time of day has an effect on weapon involvement.

> Background:

- According to the FBI, arson is defined as any willful or malicious burning or attempt to burn, with or without intent to defraud, a dwelling, house, public building, motor vehicle, aircraft, personal property of another, etc. Historically, among the types of crime in the United States, arson is the most costly one. Each year, an estimated 267,000 fires are attributed to arson, which result in $1.4 billion in property loss and cause over 2,000 injuries and 475 deaths.

- The data that we are going to use was collected by the Los Angeles Police Department as a record of crime incidents in Los Angeles dating back to 2020, which can be accessed at https://catalog.data.gov/dataset/crime-data-from-2020-to-present. This data is transcribed from original crime reports which an individual may report via 911.

- The data set has 690455 observations from the year 2020, and it is being constantly updated. The original data set contains 28 variables, many of which provided no use when determining a question to guide our project. After cleaning and renaming variables, the data set was left with 8 variables that helped us devise a question. These eight variables are month of occurrence, time occurred (ex early morning), area (geographical), crime premise (ex parking lot), crime description, victim age, victim sex, and weapon presence. This project uses three of these variables: crime description, time occurred, and weapon presence.

- The reason we chose to focus on these variables involves some unusual factors within the unchosen variables. For example, the victim sex variable was sometimes missing or indicated NA, presumably because some crimes don’t have victims or some victims are unidentifiable after the crime occurs.

- Our goal for the rest of the report will be to illustrate how we filtered the data down to our relevant variables, then to analyze and compare the rate of weapons being involved in an arson crime during two different times of day, which are late evening and early morning. 


```{r}

crime = crime%>%
  mutate(`DATE OCC` = as.character(`DATE OCC`))%>%
  mutate(`DATE OCC` = str_sub(`DATE OCC`, 1, 2))%>%
  mutate(`DATE OCC` = case_when(
    `DATE OCC` == "01" ~ "January", 
    `DATE OCC` == "02" ~ "February", 
    `DATE OCC` == "03" ~ "March", 
    `DATE OCC` == "04" ~ "April", 
    `DATE OCC` == "05" ~ "May", 
    `DATE OCC` == "06" ~ "June", 
    `DATE OCC` == "07" ~ "July", 
    `DATE OCC` == "08" ~ "August", 
    `DATE OCC` == "09" ~ "September", 
    `DATE OCC` == "10" ~ "October", 
    `DATE OCC` == "11" ~ "November", 
    `DATE OCC` == "12" ~ "December"
    ))%>%
  rename("Month Occured" = `DATE OCC`)


```


```{r}

crime = crime%>%
  rename("Time Occured" = `TIME OCC`)%>%
  mutate(`Time Occured` = as.integer(`Time Occured`)) %>% 
  mutate(`Time Occured` = case_when(
    `Time Occured` <= 400 ~ "Overnight", 
    `Time Occured`> 400 & `Time Occured` <= 800 ~ "Early Morning", 
    `Time Occured`> 800 & `Time Occured` <= 1200 ~ "Morning", 
    `Time Occured`> 1200 & `Time Occured` <= 1600 ~ "Afternoon", 
    `Time Occured` > 1600 & `Time Occured` <= 2000 ~ "Early Evening", 
    `Time Occured` > 2000 & `Time Occured` <= 2400 ~ "Late Evening"
  ))

```


```{r}

crime = crime%>%
  rename("Area Occured" = `AREA NAME`)%>%
  rename("Crime Desc" = `Crm Cd Desc`)%>%
  rename("Victim Sex" = `Vict Sex`)%>%
  rename("Premis Occured" = `Premis Desc`)

```

```{r}
crime = crime%>%
  mutate(`Weapon Desc` = as.character(`Weapon Desc`))%>%
  mutate(`Weapon Desc` = case_when(
    is.na(`Weapon Desc`) ~ "No Weapon", 
    !is.na(`Weapon Desc`) ~ "Weapon Present"
  ))%>%
  rename("Weapon Presence" = `Weapon Desc`)
```

```{r}

crime = crime%>%
  mutate(`Victim Sex` = case_when(
    `Victim Sex` == "M" ~ "Male", 
    `Victim Sex` == "F" ~ "Female", 
    `Victim Sex` == "X" ~ "Unknown"
  ))

```

```{r}
crime = crime%>%
  select(`Month Occured`, `Time Occured`, `Area Occured`, `Crime Desc`, `Vict Age`, `Victim Sex`, `Premis Occured`, `Weapon Presence`)
```

> Analysis:

```{r}
crime1 = crime %>% 
  filter(`Crime Desc` == "ARSON")%>%
  count(`Time Occured`)%>%
  mutate(total = sum(n), prop = n / total )%>%
  arrange(desc(prop))
```

```{r}
crime2 = crime%>%
  filter(`Crime Desc` == "ARSON")%>%
  group_by(`Time Occured`)%>%
  count(`Weapon Presence`)%>%
  mutate(total = sum(n), prop = n / total )%>%
  arrange(desc(prop))
```

```{r}
ggplot(crime1, aes(x = `Time Occured`, y = prop))+
  geom_col(fill = "blue") +
  ylab("Proportion of Arson crimes") +
  ggtitle("Comparison of proportion of 'Arson' crimes between different times of the day")
```

- This graph represents the proportion of `Arson` crimes that occur during all the times of the day.

- Now, lets analyse the proportion of a weapon being present during all times of the day.

```{r}
crime3 = crime2 %>% 
  filter(`Weapon Presence` == "Weapon Present") %>% 
  arrange(prop)
```

```{r}
ggplot(crime3, aes(x = `Time Occured`, y = prop))+
  geom_col(fill = "blue")+
  ylab("Proportion of a weapon being present during Arson crimes") +
  ggtitle("Comparison of 'Arson' crimes between different times of the day")
```

- This graph we can see the proportion of a weapon being present during an `Arson` crimes that occur during all times of the day.

- Through this graph we can see that the extreme proportions are Afternoon with the highest proportion and Early Morning with the lowest proportion, but both of the times can be considered as daytime. So, to take two completely different times of the day we caonsidered Early Morning and Late Evening.

- Now, lets just the number of `Arson` crimes between early morning and late evening.

```{r}
crime4 = crime2 %>% 
  filter(`Time Occured` == "Late Evening" | `Time Occured` == "Early Morning")
```

```{r}
ggplot(crime4, aes(x = `Weapon Presence`, y = prop))+
  geom_col(fill = "blue") +
  facet_wrap(vars(`Time Occured`)) +
  ylab("Proportion of presence of weapon during 'Arson' crimes") + 
  ggtitle("Comparison of proportion of presence of weapon in 'Arson' crimes",
          subtitle = "Between late evening and early morning")
```

- This graph represents the proportion of `Arson` crimes in Los Angeles from 2020 at two distinct times of the day(Early Morning and Late Evening).

- Through this graph we can infer that `Arson` crimes that occur in Late Evening have more chances of having a weapon present during the crime and the crimes occuring in Early Morning have more chances of the weapon not being present.

- Now, lets look at the proportion of weapon being present during both these times of the day.

```{r}
crime5 = crime4 %>% 
  filter(`Weapon Presence` == "Weapon Present")
```

```{r}
ggplot(crime5, aes(x = `Time Occured`, y = prop))+
  geom_col(fill = "blue ") +
  ylab("Proportion of a weapon being present during 'Arson' crimes")+
  ggtitle("Comparison of proportion of 'Arson' crimes with a weapon present",
  subtitle = "Between late evening and early morning") 
```

- This graph represents the `Arson` crimes in Los Angeles from 2020 with weapon present during the crime or not at two distinct times of the day(Early Morning and Late Evening).

- This graph infers that it is more common for a weapon to be present during an arson crime at Late Evening than in Early Morning.

- Given this data we will conduct a one-sided z-test on the difference of these two proportions.

- We assume that `Arson` crimes that occur during the early morning have no effect on the `Arson` crimes that occur during the late evening.

- The normality of the sample distribution is satisfied if the following products are atleast 10.
- n * prop

```{r}
print(crime4)
```

```{r}
crime4 %>% 
  mutate(np = n*prop)
```

- Now, we can proceed with the test.

> Hypothesis 

- The null hypothesis is that the difference between the two weapon presence proportions is 0.
- The alternate hypothesis is that the weapon presence proportion during the late evening is larger that the weapon presence proportion during the day.

> p-value

- To prove that the proportions of the two times are same, we will have a pooled p-value

```{r}
pooled_p = (100 + 75) / (320 + 290)
pooled_p
```

- The rest of the test is carried out in this way.

```{r}
standard_error = sqrt((1 / 320 + 1 / 290) * pooled_p * (1 - pooled_p))
p1_hat = 100/320
p2_hat = 75/290
 
z = (p1_hat - p2_hat) / standard_error
p_value = 1 - pnorm(z)
p_value
```

> Discussion:

- In conclusion, our analysis did not provide sufficient statistical evidence (p-value = 0.071, one-sided test) to suggest that arson crime with weapon presence is more likely to happen during the late evening compared to the early morning. The observed proportions for arson crime with weapon presence during the late evening and early morning were 0.312 and 0.259, with sample sizes of 320 and 290, respectively. Our calculated p-value of 0.07088177 is higher than the common significance threshold of 0.05, indicating that we cannot reject the null hypothesis in our z-test on the difference in sample proportions. In simpler terms, the difference between these two proportions is not large enough to suggest a significant difference. However, it is worth noting that the p-value is close enough such that if we increase the threshold to 0.1 or increase the sample sizes, the null hypothesis could be rejected. Therefore, our project has identified a possible conclusion from the data that could rise to the level of statistical significance given further analysis and testing.

- One key limitation of this study is that the data collection was not random. The dataset was derived from LAPD crime records, which only account for reported crimes. Thus, the data may not accurately represent the actual proportions of arson crimes with weapons occurring during the late evening and early morning in the whole population.

- To further validate our findings, we could conduct simulations or additional bootstrap analyses to verify the consistency of our results with the data to simulate the conditions of random sampling. For additional questions, it may also be valuable to explore other factors and their relationship with arson crime, such as the day of the week, the month of the year, or the location of the crime. Or we could compare weapon presence for different times of day for other crimes in order to see if we could find a significant result for another crime. Lastly, alternative statistical models, such as the binomial distribution model, could be used to determine and verify whether our findings remain consistent under different assumptions, either calculated using equations or through simulations.




